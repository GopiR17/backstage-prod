apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: gitlab-demo
  title: Gitlab DEMO
  description: Scaffolder Gitlab Demo
spec:
  owner: backstage/techdocs-core
  type: service
  
  parameters:
    - title: Fill in some steps
      required:
        - name
      properties:
        name:
          title: Name
          type: string
          description: Unique name of the component
          ui:autofocus: true
          ui:options:
            rows: 5
        projectId:
          title: Project id
          type: number  
        weight:
          title: Issue weight
          type: number                          
        title:
          title: Issue title
          type: string    
        description:
          title: Issue description
          type: string                    
        issueType:
          title: Type
          type: string
          ui:help: 'issue, incident, test_case'
        createdAt:
            title: Creation date
            type: string
            format: date-time
        dueDate:
            title: Due date
            type: string
            format: date-time

    - title: Choose a location
      required:
        - repoUrl
      properties:
        repoUrl:
          title: Repository Location
          type: string
          ui:field: RepoUrlPicker
          ui:options:
            allowedHosts:
              - gitlab.com

  steps:
    - id: gitlabIssue
      name: Issues
      action: gitlab:issues:create
      input:
        repoUrl: ${{ parameters.repoUrl }} # git.tech.rz.db.de?owner=devex-core&repo=test-repo
        token: ${{ secrets.USER_OAUTH_TOKEN }}
        projectId: ${{ parameters.projectId }} # 52723821
        title: ${{ parameters.title }}
        weight: ${{ parameters.weight }}
        assignees: 
          - 11013327
        description: ${{ parameters.description }}
        confidential: true
        createdAt: ${{ parameters.createdAt }} # "2023-03-11T03:45:40Z"
        dueDate: ${{ parameters.dueDate }} # "2024-03-11T03:45:40Z"
        labels: test-label1,test-label2
        issueType: ${{ parameters.issueType }}
  output:
    links:
      - title: Link to new issue
        url: ${{ steps['gitlabIssue'].output.issueUrl }}

