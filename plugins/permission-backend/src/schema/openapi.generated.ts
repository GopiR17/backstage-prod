/*
 * Copyright 2024 The Backstage Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// ******************************************************************
// * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. *
// ******************************************************************
import { createValidatedOpenApiRouter } from '@backstage/backend-openapi-utils';

export const spec = {
  openapi: '3.0.3',
  info: {
    title: '@backstage/permission-backend',
    description: 'Permission schema',
    version: '0.0.1',
  },
  servers: [
    {
      url: '/',
    },
    {
      url: 'permission',
    },
  ],
  paths: {
    '/authorize': {
      post: {
        operationId: 'Authorize',
        responses: {
          '200': {
            description: 'Success',
            content: {
              'application/json': {
                schema: {
                  type: 'object',
                  properties: {
                    items: {
                      type: 'array',
                      items: {
                        $ref: '#/components/schemas/EvaluatePermissionResponse',
                      },
                    },
                  },
                  required: ['items'],
                  additionalProperties: false,
                },
              },
            },
          },
          '400': {
            $ref: '#/components/responses/ErrorResponse',
          },
        },
        requestBody: {
          content: {
            'application/json': {
              schema: {
                $ref: '#/components/schemas/PostAuthorizeRequestBody',
              },
            },
          },
        },
      },
    },
    '/health': {
      get: {
        responses: {
          '200': {
            description: '200 response',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/GetHealth200ResponseBody',
                },
              },
            },
          },
        },
      },
    },
  },
  components: {
    responses: {
      ErrorResponse: {
        description: 'An error response from the backend.',
        content: {
          'application/json': {
            schema: {
              $ref: '#/components/schemas/Error',
            },
          },
        },
      },
    },
    schemas: {
      Error: {
        type: 'object',
        properties: {
          error: {
            type: 'object',
            properties: {
              name: {
                type: 'string',
              },
              message: {
                type: 'string',
              },
              stack: {
                type: 'string',
              },
              code: {
                type: 'string',
              },
            },
            required: ['name', 'message'],
          },
          request: {
            type: 'object',
            properties: {
              method: {
                type: 'string',
              },
              url: {
                type: 'string',
              },
            },
            required: ['method', 'url'],
          },
          response: {
            type: 'object',
            properties: {
              statusCode: {
                type: 'number',
              },
            },
            required: ['statusCode'],
          },
        },
        required: ['error', 'response'],
        additionalProperties: {},
      },
      PostAuthorizeRequestBody: {
        type: 'object',
        properties: {
          items: {
            type: 'array',
            items: {
              type: 'object',
              properties: {
                id: {
                  type: 'string',
                },
                permission: {
                  oneOf: [
                    {
                      type: 'object',
                      properties: {
                        name: {
                          type: 'string',
                        },
                        attributes: {
                          type: 'object',
                          properties: {
                            action: {
                              type: 'string',
                              enum: ['create', 'read', 'update', 'delete'],
                            },
                          },
                          additionalProperties: false,
                        },
                        type: {
                          type: 'string',
                          enum: ['basic'],
                        },
                      },
                      required: ['name', 'type', 'attributes'],
                      additionalProperties: false,
                    },
                    {
                      type: 'object',
                      properties: {
                        type: {
                          type: 'string',
                          enum: ['resource'],
                        },
                        resourceType: {
                          type: 'string',
                        },
                        name: {
                          type: 'string',
                        },
                        attributes: {
                          type: 'object',
                          properties: {
                            action: {
                              type: 'string',
                              enum: ['create', 'read', 'update', 'delete'],
                            },
                          },
                          additionalProperties: false,
                        },
                      },
                      required: ['type', 'name', 'attributes', 'resourceType'],
                      additionalProperties: false,
                    },
                  ],
                },
                resourceRef: {
                  type: 'string',
                },
              },
              required: ['id', 'permission'],
              additionalProperties: false,
            },
          },
        },
        required: ['items'],
      },
      PermissionRuleParam: {
        oneOf: [
          {
            type: 'string',
          },
          {
            type: 'number',
          },
          {
            type: 'boolean',
            nullable: true,
          },
        ],
      },
      PermissionCondition: {
        type: 'object',
        properties: {
          resourceType: {
            type: 'string',
          },
          rule: {
            type: 'string',
          },
          params: {
            type: 'object',
            additionalProperties: {
              oneOf: [
                {
                  $ref: '#/components/schemas/PermissionRuleParam',
                },
                {
                  type: 'array',
                  items: {
                    $ref: '#/components/schemas/PermissionRuleParam',
                  },
                },
              ],
            },
          },
        },
        required: ['resourceType', 'rule'],
        additionalProperties: false,
      },
      PermissionCriteria: {
        oneOf: [
          {
            type: 'object',
            properties: {
              allOf: {
                type: 'array',
                items: {
                  $ref: '#/components/schemas/PermissionCriteria',
                },
                minItems: 1,
              },
            },
            additionalProperties: false,
          },
          {
            type: 'object',
            properties: {
              anyOf: {
                type: 'array',
                items: {
                  $ref: '#/components/schemas/PermissionCriteria',
                },
                minItems: 1,
              },
            },
            additionalProperties: false,
          },
          {
            type: 'object',
            properties: {
              not: {
                type: 'array',
                items: {
                  $ref: '#/components/schemas/PermissionCriteria',
                },
                minItems: 1,
              },
            },
            additionalProperties: false,
          },
          {
            $ref: '#/components/schemas/PermissionCondition',
          },
        ],
      },
      DefinitivePolicyDecision: {
        type: 'object',
        properties: {
          result: {
            type: 'string',
            enum: ['ALLOW', 'DENY'],
          },
          id: {
            type: 'string',
          },
        },
        required: ['result', 'id'],
        additionalProperties: false,
      },
      ConditionalPolicyDecision: {
        type: 'object',
        properties: {
          result: {
            type: 'string',
            enum: ['CONDITIONAL'],
          },
          pluginId: {
            type: 'string',
          },
          resourceType: {
            type: 'string',
          },
          conditions: {
            $ref: '#/components/schemas/PermissionCriteria',
          },
          id: {
            type: 'string',
          },
        },
        required: ['result', 'id', 'pluginId', 'resourceType', 'conditions'],
        additionalProperties: false,
      },
      EvaluatePermissionResponse: {
        oneOf: [
          {
            $ref: '#/components/schemas/ConditionalPolicyDecision',
          },
          {
            $ref: '#/components/schemas/DefinitivePolicyDecision',
          },
        ],
      },
      PostAuthorize400ResponseBody: {
        type: 'object',
        properties: {
          error: {
            type: 'object',
            properties: {
              name: {
                type: 'string',
              },
              message: {
                type: 'string',
              },
            },
            required: ['name', 'message'],
          },
          request: {
            type: 'object',
            properties: {
              method: {
                type: 'string',
              },
              url: {
                type: 'string',
              },
            },
            required: ['method', 'url'],
          },
          response: {
            type: 'object',
            properties: {
              statusCode: {
                type: 'number',
              },
            },
            required: ['statusCode'],
          },
        },
        required: ['error', 'request', 'response'],
      },
      GetHealth200ResponseBody: {
        type: 'object',
        properties: {
          status: {
            type: 'string',
          },
        },
        required: ['status'],
      },
    },
  },
} as const;
export const createOpenApiRouter = async (
  options?: Parameters<typeof createValidatedOpenApiRouter>['1'],
) => createValidatedOpenApiRouter<typeof spec>(spec, options);
